<!-- Save this as index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>GitHub Events</title>
    <style>
      body {
        font-family: sans-serif;
        background: #f5f5f5;
        padding: 20px;
      }
      h1 {
        color: #333;
      }
      ul {
        padding-left: 0;
      }
      li {
        list-style: none;
        background: #fff;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body>
    <h1>Latest GitHub Events</h1>
    <ul id="event-list">
      <li>Loading...</li>
    </ul>

    <script>
      const BACKEND_URL = "https://webhook-git.onrender.com"; // üîÅ your ngrok URL here

      async function fetchEvents() {
        try {
          const res = await fetch(`${BACKEND_URL}/events`);
          const events = await res.json();

          const list = document.getElementById("event-list");
          list.innerHTML = ""; // Clear existing list

          if (!Array.isArray(events) || events.length === 0) {
            list.innerHTML = "<li>No events found.</li>";
            return;
          }

          events.forEach((event) => {
            let text = "";
            const { author, action, from_branch, to_branch, timestamp } = event;

            if (action === "PUSH") {
              text = `${author} pushed to ${to_branch} on ${timestamp}`;
            } else if (action === "PULL_REQUEST") {
              text = `${author} submitted a pull request from ${from_branch} to ${to_branch} on ${timestamp}`;
            } else if (action === "MERGE") {
              text = `${author} merged branch ${from_branch} to ${to_branch} on ${timestamp}`;
            }

            const li = document.createElement("li");
            li.textContent = text;
            list.appendChild(li);
          });
        } catch (error) {
          console.error("‚ùå Error fetching events:", error);
          document.getElementById(
            "event-list"
          ).innerHTML = `<li>Error loading events.</li>`;
        }
      }

      // Initial fetch
      fetchEvents();

      // Poll every 15 seconds
      setInterval(fetchEvents, 15000);
    </script>
  </body>
</html>
